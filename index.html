<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Universitet Tanlash</title>
  <link rel="stylesheet" href="dashboard.css">
  <style>
    /* Loading Animation */
    .loader-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4f46e5;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="loader-container" id="loader">
    <div class="loader"></div>
  </div>

  <form class="form-container" id="loginForm">
    <h2>Universitet Tanlash Formasi</h2>

    <label class="input-label" for="university">Universitet</label>
    <select id="university" class="select-field" required>
      <option value="">Tanlang</option>
    </select>

    <label class="input-label" for="educationType">Ta’lim turi</label>
    <select id="educationType" class="select-field" required disabled>
      <option value="">Tanlang</option>
    </select>

    <label class="input-label" for="studyDirection">Yo‘nalish</label>
    <select id="studyDirection" class="select-field" required disabled>
      <option value="">Tanlang</option>
    </select>

    <label class="input-label" for="year">O‘quv yili</label>
    <input id="year" class="input-field" type="text" value="2024/2025" readonly />

    <button class="submit-btn" type="submit">Yuborish</button>
  </form>

  <div id="error" class="error"></div>
  <div id="result" class="selected-uni-info" style="display: none;"></div>

  <script>
    const universitySelect = document.getElementById('university');
    const educationTypeSelect = document.getElementById('educationType');
    const studyDirectionSelect = document.getElementById('studyDirection');
    const form = document.getElementById('loginForm');
    const errorDiv = document.getElementById('error');
    const resultDiv = document.getElementById('result');
    const loader = document.getElementById('loader');

    let universitiesData = [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        universitiesData = data;
        const universities = [...new Set(data.map(item => item.universitet))].sort();
        universities.forEach(uni => {
          const option = document.createElement('option');
          option.value = uni;
          option.textContent = uni;
          universitySelect.appendChild(option);
        });
      })
      .catch(err => {
        errorDiv.textContent = "Maʼlumotlarni yuklashda xatolik yuz berdi";
        console.error(err);
      });

    universitySelect.addEventListener('change', () => {
      const selectedUni = universitySelect.value;
      const filtered = universitiesData.filter(item => item.universitet === selectedUni);

      const types = [...new Set(filtered.map(item => item.shakl))].sort();
      educationTypeSelect.innerHTML = '<option value="">Tanlang</option>';
      types.forEach(t => {
        const option = document.createElement('option');
        option.value = t;
        option.textContent = t;
        educationTypeSelect.appendChild(option);
      });

      const directions = [...new Set(filtered.map(item => item.nomi))].sort();
      studyDirectionSelect.innerHTML = '<option value="">Tanlang</option>';
      directions.forEach(d => {
        const option = document.createElement('option');
        option.value = d;
        option.textContent = d;
        studyDirectionSelect.appendChild(option);
      });

      educationTypeSelect.disabled = false;
      studyDirectionSelect.disabled = false;
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      loader.style.display = 'flex';

      // Simulate 1.5s delay for loading animation
      await new Promise(resolve => setTimeout(resolve, 1500));

      const university = universitySelect.value;
      const educationType = educationTypeSelect.value;
      const studyDirection = studyDirectionSelect.value;

      const selected = universitiesData.find(item =>
        item.universitet === university &&
        item.shakl.toLowerCase() === educationType.toLowerCase() &&
        item.nomi === studyDirection
      );

      loader.style.display = 'none';

      if (selected) {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <h3>Tanlangan Universitet Ma'lumotlari</h3>
          <div class="info-list">
            <p><span>Universitet:</span> ${selected.universitet}</p>
            <p><span>Viloyat:</span> ${selected.viloyat}</p>
            <p><span>Yo‘nalish:</span> ${selected.nomi}</p>
            <p><span>1-fan:</span> ${selected['1-fan']}</p>
            <p><span>2-fan:</span> ${selected['2-fan']}</p>
            <p><span>Shifr:</span> ${selected.shifr}</p>
            <p><span>Ta'lim shakli:</span> ${selected.shakl}</p>
            <p><span>Til:</span> ${selected.til}</p>
            <p><span>Grant ball:</span> ${selected.grant_ball}</p>
            <p><span>Kontrakt ball:</span> ${selected.contract_ball}</p>
          </div>
        `;
      } else {
        resultDiv.style.display = 'none';
        errorDiv.textContent = "Mos ma'lumot topilmadi.";
      }
    });
  </script>
</body>
</html>